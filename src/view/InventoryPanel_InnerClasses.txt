
    // Renderizador de botão para a tabela
    class ButtonRenderer extends JButton implements javax.swing.table.TableCellRenderer {
        public ButtonRenderer() {
            setOpaque(true);
        }

        public Component getTableCellRendererComponent(JTable table, Object value,
                boolean isSelected, boolean hasFocus, int row, int column) {
            if (isSelected) {
                setForeground(table.getSelectionForeground());
                setBackground(table.getSelectionBackground());
            } else {
                setForeground(table.getForeground());
                setBackground(UIManager.getColor("Button.background"));
            }
            setText((value == null) ? "Ver/Editar" : value.toString());
            return this;
        }
    }

    // Editor de botão para a tabela
    class ButtonEditor extends DefaultCellEditor {
        protected JButton button;
        private String label;
        private boolean isPushed;
        private Computer currentComputer;

        public ButtonEditor(JCheckBox checkBox) {
            super(checkBox);
            button = new JButton();
            button.setOpaque(true);
            button.addActionListener(e -> fireEditingStopped());
        }

        public Component getTableCellEditorComponent(JTable table, Object value,
                boolean isSelected, int row, int column) {
            if (isSelected) {
                button.setForeground(table.getSelectionForeground());
                button.setBackground(table.getSelectionBackground());
            } else {
                button.setForeground(table.getForeground());
                button.setBackground(table.getBackground());
            }
            label = (value == null) ? "Ver/Editar" : value.toString();
            button.setText(label);
            isPushed = true;
            
            // Obtém o computador correspondente à linha
            int modelRow = table.convertRowIndexToModel(row);
            currentComputer = tableModel.getComputerAt(modelRow);
            
            return button;
        }

        public Object getCellEditorValue() {
            if (isPushed) {
                // Abre o dialog de observação
                openObservationDialog(currentComputer);
            }
            isPushed = false;
            return label;
        }

        public boolean stopCellEditing() {
            isPushed = false;
            return super.stopCellEditing();
        }

        protected void fireEditingStopped() {
            super.fireEditingStopped();
        }
    }

    private void openObservationDialog(Computer computer) {
        JDialog dialog = new JDialog((Frame) SwingUtilities.getWindowAncestor(this), "Observações - " + computer.getTag(), true);
        dialog.setSize(400, 300);
        dialog.setLocationRelativeTo(this);
        dialog.setLayout(new BorderLayout());

        JTextArea textArea = new JTextArea(computer.getObservation());
        textArea.setLineWrap(true);
        textArea.setWrapStyleWord(true);
        JScrollPane scrollPane = new JScrollPane(textArea);
        dialog.add(scrollPane, BorderLayout.CENTER);

        JButton saveButton = new JButton("Salvar");
        saveButton.addActionListener(e -> {
            String newObservation = textArea.getText();
            computer.setObservation(newObservation);
            if (controller.updateComputer(computer, controller.getCurrentUser())) {
                // Atualiza na tabela visualmente (embora o modelo já tenha o objeto atualizado)
                // tableModel.fireTableDataChanged(); // Não é estritamente necessário se o objeto é o mesmo, mas bom para garantir
                JOptionPane.showMessageDialog(dialog, "Observação salva com sucesso!", "Sucesso", JOptionPane.INFORMATION_MESSAGE);
                dialog.dispose();
            } else {
                JOptionPane.showMessageDialog(dialog, "Erro ao salvar observação.", "Erro", JOptionPane.ERROR_MESSAGE);
            }
        });
        
        JPanel buttonPanel = new JPanel();
        buttonPanel.add(saveButton);
        dialog.add(buttonPanel, BorderLayout.SOUTH);

        dialog.setVisible(true);
    }
